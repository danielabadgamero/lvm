#ifndef VM_H
#define VM_H

#define MEM_SIZE (1ull << 32)
#define DISK_SIZE (1ull << 32)

/*	Operation codes
	Fixed 1 byte operation size
	PC points at the current executing instruction + 1

	a,b: register
	().: memory address, size (B = 1 byte, W = 2 bytes, L = 4 bytes).
	reg[a]: register number a.
	^: top of stack
	^{}: push item to stack
	v: pop an item from stack

	HLT	00000000	0 --> running
	----------------------------------------------------------------
	HLTS	00000001	0 --> running, out(disk)
	----------------------------------------------------------------
	RCAL	00000010	^{pc + 1}, pc --> (pc).B + pc
	DCAL	00000011	^{pc + 4}, pc --> (pc).L
	----------------------------------------------------------------
	RET	00000100	pc --> ^, v
	PUSH.B	00000101	^{(pc).B}
	PUSH.W	00000110	^{(pc).W}
	PUSH.L	00000111	^{(pc).L}
	----------------------------------------------------------------
	PUSHR	000010aa	^{a}
	PSHI.B	000011aa	^{(a).B}
	----------------------------------------------------------------
	PSHI.W	000100aa	^{(a).W}
	PSHI.L	000101aa	^{(a).L}
	POP	00011000	v
	SIND.B	00011001	(^).B --> ^
	SIND.W	00011010	(^).W --> ^
	SIND.L	00011011	(^).L --> ^
	POPR	000111aa	^ --> a, v
	----------------------------------------------------------------
	MOVR	0010aabb	a --> b
	SET.B	001100aa	(pc).B --> a
	SET.W	001101aa	(pc).W --> a
	SET.L	001110aa	(pc).L --> a
	----------------------------------------------------------------
	ADD	010000aa	^ + a --> ^
	SUB	010001aa	^ - a --> ^
	MUL	010010aa	^ * a --> ^
	DIV	010011aa	^ / a --> ^
	MOD	010100aa	^ % a --> ^
	AND	010101aa	^ & a --> ^
	OR	010110aa	^ | a --> ^
	NOT	01011100	~^ --> ^
	LSFT	01011101	^ << 1 --> ^
	RSFT	01011110	^ >> 1 --> ^
	INC	01011111	^ + 1 --> ^
	ADDR	011000aa        a + ^ --> ^
	SUBR	011001aa	a - a --> ^
	MULR	011010aa	a * a --> ^
	DIVR	011011aa	a / a --> ^
	MODR	011100aa	a % a --> ^
	ANDR	011101aa	a & a --> ^
	ORR	011110aa	a | a --> ^
	NOTR	01111100	~a --> ^
	LSFTR	01111101	a << 1 --> ^
	RSFTR	01111110	a >> 1 --> ^
	INCR	01111111	a + 1 --> ^
	---------------------------------------------------------------
	GRT	100000aa	
*/

extern int running;

extern unsigned int pc;
extern int reg[4];
extern int bit;
extern unsigned char* mem;
extern unsigned char disk[DISK_SIZE];

void lvm_init(const char*);
void lvm_exec();

#endif
